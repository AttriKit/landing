---
// Demo Modal Component
---

<div id="demo-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="demo-modal-title" data-open="false">
  <!-- Modal Overlay -->
  <div class="modal-overlay" data-close-demo-modal></div>

  <!-- Modal Content -->
  <div class="modal-container modal-container-sm">
    <!-- Close Button -->
    <button class="demo-modal-close" data-close-demo-modal aria-label="关闭">
      <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
        <path d="M6 18L18 6M6 6l12 12"/>
      </svg>
    </button>

    <div class="modal-body">
      <!-- Warning Icon -->
      <div class="demo-warning-icon">
        <svg width="48" height="48" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z" />
        </svg>
      </div>

      <!-- Warning Message -->
      <div class="demo-warning-content">
        <h4>演示环境须知</h4>

        <div class="demo-warning-list-wrapper">
          <ul class="demo-warning-list">
            <li>
              <svg width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
              </svg>
              <span>本环境仅供功能演示，<strong>不可用于真实广告投放</strong></span>
            </li>
            <li>
              <svg width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
              </svg>
              <span>功能与开发版本保持同步，可能包含实验性特性</span>
            </li>
            <li>
              <svg width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
              </svg>
              <span>服务稳定性不作保证，数据可能会被定期清理</span>
            </li>
            <li>
              <svg width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
              </svg>
              <span>仅供参考体验，生产环境请使用<strong>私有化部署版本</strong></span>
            </li>
          </ul>
        </div>
      </div>

      <!-- Test Account -->
      <div class="demo-account-info">
        <div class="demo-account-item">
          <span>账号：admin</span>
          <button class="demo-copy-btn" data-copy="admin" aria-label="复制账号">
            <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
              <path d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/>
            </svg>
          </button>
        </div>
        <div class="demo-account-item">
          <span>密码：aktoData@101</span>
          <button class="demo-copy-btn" data-copy="aktoData@101" aria-label="复制密码">
            <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
              <path d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/>
            </svg>
          </button>
        </div>
      </div>

      <!-- Action Button -->
      <div class="demo-modal-actions">
        <button class="btn btn-primary" id="demo-try-btn">立即体验</button>
      </div>
    </div>
  </div>
</div>

<style is:global>
  /* Modal base styles */
  .modal {
    position: fixed;
    inset: 0;
    z-index: 1300;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s ease;
  }

  .modal[data-open="true"] {
    opacity: 1;
    pointer-events: auto;
  }

  .modal-overlay {
    position: absolute;
    inset: 0;
    background: rgba(26, 34, 46, 0.6);
    backdrop-filter: blur(4px);
  }

  .modal-container {
    position: relative;
    z-index: 1;
    background: white;
    border-radius: 16px;
    box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
    width: 90%;
    max-height: 90vh;
    overflow-y: auto;
    transform: scale(0.95);
    transition: transform 0.3s ease;
  }

  .modal[data-open="true"] .modal-container {
    transform: scale(1);
  }

  .modal-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 1.5rem;
    border-bottom: 1px solid var(--color-border);
  }

  .modal-header h3 {
    margin: 0;
    font-size: 1.5rem;
    color: var(--color-text-primary);
  }

  .modal-close {
    background: none;
    border: none;
    color: var(--color-text-muted);
    cursor: pointer;
    padding: 0.5rem;
    border-radius: 8px;
    transition: background 0.2s ease, color 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .modal-close:hover {
    background: var(--color-bg-secondary);
    color: var(--color-text-primary);
  }

  .modal-close:focus-visible {
    outline: 2px solid var(--color-accent-primary);
    outline-offset: 2px;
  }

  .modal-body {
    padding: 1.5rem;
    text-align: center;
  }

  .modal-container-sm {
    max-width: 480px;
  }

  .demo-modal-close {
    position: absolute;
    top: 1rem;
    right: 1rem;
    background: none;
    border: none;
    color: var(--color-text-muted);
    cursor: pointer;
    padding: 0.5rem;
    border-radius: 8px;
    transition: background 0.2s ease, color 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 10;
  }

  .demo-modal-close:hover {
    background: var(--color-bg-secondary);
    color: var(--color-text-primary);
  }

  .demo-modal-close:focus-visible {
    outline: 2px solid var(--color-accent-primary);
    outline-offset: 2px;
  }

  .demo-warning-icon {
    text-align: center;
    margin-bottom: 1.5rem;
  }

  .demo-warning-icon svg {
    color: var(--color-warning);
  }

  .demo-warning-content {
    margin-bottom: 1.5rem;
    text-align: center;
  }

  .demo-warning-content h4 {
    font-size: 1.125rem;
    font-weight: 600;
    color: var(--color-text-primary);
    text-align: center;
    margin: 0 0 1rem 0;
  }

  .demo-account-info {
    background: var(--color-bg-secondary);
    border-radius: 8px;
    padding: 1rem 1.25rem;
    margin: 0 auto 1.5rem auto;
    display: inline-block;
    min-width: 320px;
  }

  .demo-account-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 0.5rem;
  }

  .demo-account-item:last-child {
    margin-bottom: 0;
  }

  .demo-account-item span {
    font-size: 0.875rem;
    color: var(--color-text-secondary);
    font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Fira Code', monospace;
  }

  .demo-copy-btn {
    background: none;
    border: none;
    color: var(--color-text-muted);
    cursor: pointer;
    padding: 0.375rem;
    border-radius: 4px;
    transition: background 0.2s ease, color 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
  }

  .demo-copy-btn:hover {
    background: var(--color-accent-subtle);
    color: var(--color-accent-primary);
  }

  .demo-copy-btn:focus-visible {
    outline: 2px solid var(--color-accent-primary);
    outline-offset: 2px;
  }

  .demo-copy-btn.copied {
    color: var(--color-success);
  }

  .demo-copy-btn.copied svg {
    stroke: var(--color-success);
  }

  .demo-warning-list {
    list-style: none;
    padding: 0;
    margin: 0;
    display: flex;
    flex-direction: column;
    gap: 0.875rem;
  }

  .demo-warning-list-wrapper {
    display: inline-block;
    text-align: left;
    min-width: 320px;
  }

  .demo-warning-list li {
    display: flex;
    align-items: flex-start;
    gap: 0.75rem;
    color: var(--color-text-secondary);
    font-size: 0.9375rem;
    line-height: 1.5;
    justify-content: flex-start;
  }

  .demo-warning-list li svg {
    color: var(--color-accent-primary);
    flex-shrink: 0;
    margin-top: 0.125rem;
  }

  .demo-warning-list li strong {
    color: var(--color-warning);
    font-weight: 600;
  }

  .demo-modal-actions {
    display: flex;
    justify-content: center;
  }

  .demo-modal-actions .btn {
    width: auto;
    min-width: 320px;
  }

  .btn-block {
    width: 100%;
    margin-top: 0.5rem;
  }
</style>

<script>
  // Demo Modal state and functions
  const demoModal = document.querySelector('#demo-modal');
  const demoOverlay = demoModal?.querySelector('.modal-overlay');
  let lastFocusedElement: HTMLElement | null = null;

  // Focus trap for demo modal
  function getFocusableElements(container: HTMLElement): HTMLElement[] {
    const focusableSelectors = [
      'a[href]',
      'button:not([disabled])',
      'textarea:not([disabled])',
      'input:not([disabled])',
      'select:not([disabled])',
      '[tabindex]:not([tabindex="-1"])'
    ];
    return Array.from(container.querySelectorAll<HTMLElement>(focusableSelectors.join(', ')));
  }

  function trapFocus(event: KeyboardEvent) {
    if (!demoModal || event.key !== 'Tab') return;

    const focusableElements = getFocusableElements(demoModal);
    if (focusableElements.length === 0) return;

    const firstElement = focusableElements[0];
    const lastElement = focusableElements[focusableElements.length - 1];

    if (event.shiftKey) {
      if (document.activeElement === firstElement) {
        event.preventDefault();
        lastElement.focus();
      }
    } else {
      if (document.activeElement === lastElement) {
        event.preventDefault();
        firstElement.focus();
      }
    }
  }

  function openDemoModal(triggerButton?: HTMLElement) {
    lastFocusedElement = triggerButton || document.activeElement as HTMLElement;

    demoModal?.setAttribute('data-open', 'true');
    document.body.style.overflow = 'hidden';

    setTimeout(() => {
      const firstButton = demoModal?.querySelector<HTMLButtonElement>('.demo-modal-actions .btn');
      firstButton?.focus();
    }, 100);

    document.addEventListener('keydown', trapFocus);
  }

  function closeDemoModal() {
    demoModal?.setAttribute('data-open', 'false');
    document.body.style.overflow = '';

    document.removeEventListener('keydown', trapFocus);

    setTimeout(() => {
      lastFocusedElement?.focus();
    }, 300);
  }

  // Attach event listeners for demo modal open
  document.querySelectorAll('[data-open-demo-modal]').forEach(btn => {
    btn.addEventListener('click', (e) => {
      e.preventDefault();
      openDemoModal(btn as HTMLElement);
    });
  });

  // Attach event listeners for demo modal close
  document.querySelectorAll('[data-close-demo-modal]').forEach(btn => {
    btn.addEventListener('click', closeDemoModal);
  });

  demoOverlay?.addEventListener('click', closeDemoModal);

  // Close on Escape key
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && demoModal?.getAttribute('data-open') === 'true') {
      closeDemoModal();
    }
  });

  // "立即体验" button - open demo link
  const demoTryBtn = document.querySelector<HTMLButtonElement>('#demo-try-btn');
  demoTryBtn?.addEventListener('click', () => {
    // TODO: Replace with actual demo URL
    window.open('https://demo.attrikit.com', '_blank');
    closeDemoModal();
  });

  // Copy to clipboard functionality
  document.querySelectorAll<HTMLElement>('[data-copy]').forEach(btn => {
    btn.addEventListener('click', async () => {
      const textToCopy = btn.getAttribute('data-copy');
      if (!textToCopy) return;

      try {
        await navigator.clipboard.writeText(textToCopy);

        // Show copied state
        btn.classList.add('copied');

        // Reset after 2 seconds
        setTimeout(() => {
          btn.classList.remove('copied');
        }, 2000);
      } catch (err) {
        console.error('Failed to copy:', err);
      }
    });
  });
</script>
